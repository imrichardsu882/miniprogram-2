<view class="container">
  <view wx:if="{{pageState === 'loading'}}" class="state-container">
    <text>正在加载...</text>
  </view>

  <view wx:if="{{pageState === 'auth'}}" class="state-container auth-container">
    <view class="header">
      <view class="title">欢迎使用</view>
      <view class="subtitle">三通英语助手</view>
    </view>

    <view class="auth-main">
      <view class="auth-button" bindtap="handleAuth" hover-class="button-hover">
        <text>微信授权登录</text>
      </view>
      <view class="guest-button" bindtap="enterAsGuest">先逛逛 (体验模式)</view>
    </view>

    <view class="footer-area">
      <text class="footer-notice">本小程序为内部教学工具，仅限授权师生登录使用。</text>
    </view>
  </view>

  <view wx:if="{{pageState === 'profile'}}" class="state-container profile-setup-container">
    <view class="header">
      <view class="title">创建您的学籍档案</view>
      <view class="subtitle">请设置您在小程序中展示的头像和昵称</view>
    </view>

    <view class="profile-form">
      <button class="avatar-wrapper" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
        <image class="avatar" src="{{avatarUrl || '/images/default-avatar.png'}}"></image>
      </button>
      <view class="nickname-label">昵称</view>
      <input class="nickname-input" type="nickname" placeholder="请输入昵称" value="{{nickname}}" bindinput="onNicknameInput"/>
    </view>

    <view class="confirm-btn" bindtap="onConfirmProfile">确认并继续</view>
  </view>


  <view wx:if="{{pageState === 'role'}}" class="state-container">
    <view class="header">
      <view class="title">欢迎，{{userInfo.nickName}}</view>
      <view class="subtitle">请选择您的身份</view>
    </view>
    <view class="card-list">
      <view class="role-card teacher-card" hover-class="card-hover" bindtap="onRoleSelect" data-role="teacher">
        <view class="card-text">
          <view class="card-title">我是老师</view>
          <view class="card-description">创建课程，布置作业</view>
        </view>
      </view>
      <view class="role-card student-card" hover-class="card-hover" bindtap="onRoleSelect" data-role="student">
        <view class="card-text">
          <view class="card-title">我是学生</view>
          <view class="card-description">开始你的学习之旅</view>
        </view>
      </view>
    </view>
  </view>

  <view class="modal-mask" wx:if="{{showPasswordModal}}" bindtap="onPasswordCancel">
    <view class="modal-container" catchtap="preventModalClose">
      <view class="modal-title">请输入教师口令</view>
      <view class="modal-input-wrapper">
        <input class="modal-input" type="password" value="{{passwordInput}}" bindinput="onPasswordInput" maxlength="20" focus="{{true}}" placeholder="请输入口令"/>
      </view>
      <view class="modal-actions">
        <view class="modal-button cancel" bindtap="onPasswordCancel">取消</view>
        <view class="modal-button-divider"></view>
        <view class="modal-button confirm" bindtap="onPasswordConfirm">确认</view>
      </view>
    </view>
  </view>
</view>