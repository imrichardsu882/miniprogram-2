<view class="container">
  <!-- 加载状态 -->
  <view wx:if="{{pageState === 'loading'}}" class="loading-container">
    <view class="loading-animation">
      <view class="loading-dots">
        <view class="dot"></view>
        <view class="dot"></view>
        <view class="dot"></view>
      </view>
    </view>
    <text class="loading-text">正在为您准备学习环境...</text>
  </view>

  <!-- 授权登录页面 -->
  <view wx:if="{{pageState === 'auth'}}" class="auth-container">
    <view class="auth-background">
      <view class="auth-gradient"></view>
      <view class="auth-pattern"></view>
    </view>
    
    <view class="auth-content">
      <view class="auth-header">
        <view class="auth-title">
          <text class="main-title">三通英语助手</text>
        </view>
      </view>

      <view class="auth-actions">
        <button class="auth-button primary" bindtap="handleAuth" hover-class="button-hover">
          <text class="button-icon">📱</text>
          <text class="button-text">微信授权登录</text>
        </button>
        
        <button class="auth-button secondary" bindtap="enterAsGuest" hover-class="button-hover">
          <text class="button-icon">🎯</text>
          <text class="button-text">体验模式</text>
        </button>
      </view>
    </view>

    <!-- 底部声明 - 简化版本 -->
    <view class="footer-container">
      <text class="footer-text">内部教学工具 · 师生专用</text>
    </view>
  </view>

  <!-- 重新设计的主页 -->
  <view wx:if="{{pageState === 'role'}}" class="home-container">
    <!-- 模块1：顶部导航区（简化） -->
    <view class="top-nav">
      <view class="nav-left">
        <text class="app-name">三通英语助手</text>
      </view>
    </view>

    <!-- 模块2：辅助功能区（排行榜） -->
    <view class="secondary-actions-section">
      <view class="action-grid">
        <view class="action-card leaderboard-card" hover-class="card-hover" bindtap="goLeaderboard">
          <view class="card-icon">
            <text class="icon-trophy">🏆</text>
          </view>
          <text class="card-text">排行榜</text>
        </view>
        
        <view class="action-card teacher-card" hover-class="card-hover" bindtap="onRoleSelect" data-role="teacher">
          <view class="card-icon">
            <text class="icon-teacher">👨‍🏫</text>
          </view>
          <text class="card-text">教师功能</text>
        </view>
      </view>
    </view>

    <!-- 模块3：核心转化区（开始练习） -->
    <view class="primary-action-section">
      <view class="primary-action-card" hover-class="primary-card-hover" bindtap="onRoleSelect" data-role="student">
        <view class="card-badge" wx:if="{{hasPracticeUpdate}}">
          <view class="badge-dot"></view>
        </view>
        <view class="action-icon">
          <text class="icon-book">📖</text>
        </view>
        <view class="action-content">
          <text class="action-title">开始练习</text>
          <text class="action-subtitle">每天10分钟，轻松进步</text>
        </view>
        <view class="action-arrow">
          <text class="arrow-icon">→</text>
        </view>
      </view>
    </view>

    <!-- 模块4：版本更新区（垂直滚动） -->
    <view class="updates-section" wx:if="{{updates.length > 0}}">
      <view class="section-header">
        <text class="section-title">版本更新</text>
        <view class="unread-indicator" wx:if="{{hasUnreadUpdates}}">
          <text class="unread-count">{{unreadCount}}</text>
        </view>
      </view>
      
      <scroll-view class="updates-scroll" scroll-y="true">
        <view class="updates-container">
          <view 
            wx:for="{{updates}}" 
            wx:key="id" 
            class="update-card {{item.read ? 'read' : 'unread'}}" 
            hover-class="update-card-hover"
            bindtap="viewUpdate"
            data-update="{{item}}"
          >
            <view class="update-badge" wx:if="{{!item.read}}">
              <view class="badge-dot"></view>
            </view>
            <view class="update-content">
              <text class="update-title">{{item.title}}</text>
              <text class="update-description">{{item.description}}</text>
            </view>
            <view class="update-arrow">
              <text class="arrow-icon">→</text>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- 教师口令弹窗 -->
  <view class="modal-mask" wx:if="{{showPasswordModal}}" bindtap="onPasswordCancel">
    <view class="modal-container" catchtap="preventModalClose">
      <view class="modal-header">
        <text class="modal-title">教师验证</text>
      </view>
      
      <view class="modal-input-wrapper">
          <input class="modal-input" type="password" value="{{passwordInput}}" bindinput="onPasswordInput" maxlength="20" focus="{{true}}" placeholder="输入口令"/>
      </view>
      
      <view class="modal-actions">
        <button class="modal-button cancel" bindtap="onPasswordCancel">取消</button>
        <button class="modal-button confirm" bindtap="onPasswordConfirm">确认</button>
      </view>
    </view>
  </view>
</view>