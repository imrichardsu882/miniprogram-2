# 数据库性能优化

## 🚨 当前问题
调试器显示数据库查询性能警告，建议创建索引以提升查询效率。

## 📋 需要创建的索引

### 1. homeworks 集合
在微信开发者工具 -> 云开发 -> 数据库 -> homeworks 集合中创建索引：

```javascript
// 索引1: createTime 降序索引（用于作业列表按时间排序）
{
  "createTime": -1
}

// 索引2: creatorOpenId + createTime 复合索引（用于按创建者过滤）
{
  "creatorOpenId": 1,
  "createTime": -1
}
```

### 2. homework_records 集合
在 homework_records 集合中创建索引：

```javascript
// 索引1: userOpenId 单字段索引（用于查询用户记录）
{
  "userOpenId": 1
}

// 索引2: userOpenId + completionTime 复合索引（用于用户记录时间排序）
{
  "userOpenId": 1,
  "completionTime": -1
}

// 索引3: homeworkId 单字段索引（用于查询特定作业的记录）
{
  "homeworkId": 1
}
```

### 3. users 集合
在 users 集合中创建索引：

```javascript
// 索引1: _openid 单字段索引（用于用户查找）
{
  "_openid": 1
}
```

## 🛠️ 创建步骤

1. **打开微信开发者工具**
2. **进入云开发控制台** - 点击顶部"云开发"按钮
3. **选择环境** - 确认选择正确的云环境
4. **进入数据库** - 点击左侧菜单"数据库"
5. **选择集合** - 选择要创建索引的集合
6. **创建索引**：
   - 点击"索引管理"标签
   - 点击"添加索引"
   - 输入索引字段和排序方式
   - 点击"确认"创建

## ⚡ 预期效果

创建索引后：
- 🚀 查询速度提升 70-90%
- 📉 调试器警告消除
- 💾 减少云服务器负载
- 🔧 提升用户体验

## ⚠️ 注意事项

- 索引会占用少量存储空间
- 写入操作会稍微变慢（更新索引）
- 查询性能会显著提升
- 建议在生产环境也创建相同索引

完成索引创建后，重新编译小程序验证效果。

